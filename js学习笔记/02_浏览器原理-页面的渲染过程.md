# 在浏览器中输入url之后浏览器做的事情(流程)

如你在浏览器的url中输入了某个网站的`域名`,这时候浏览器就会拿到这个域名进行`DNS解析(domain name system)`解析出这个域名的`ip地址`,之后就可以通过这个`ip地址`去访问我们的服务器,就可以跟服务器进行沟通,让服务器给我们返回东西,浏览器拿到东西后就会进行解析。

url => DNS解析 => 访问服务器 => 服务器做出响应 => 浏览器解析服务器返回的东西


# 网页加载静态资源的过程

网页加载静态资源的过程
用户输入url之后浏览器解析完获取到ip地址去访问服务器,服务器返回一个html文件,浏览器在解析html文件时,如碰到`link元素、script元素、图片`等,浏览器就去服务器下载对应资源,


# 渲染引擎如何解析页面
![渲染引擎解析页面过程](/image/%E6%B5%8F%E8%A7%88%E5%99%A8%E8%A7%A3%E6%9E%90%E9%A1%B5%E9%9D%A2%E8%BF%87%E7%A8%8B.png)

加载HTML => 解析HTML(遇到css会去加载css并解析) => 创建DOM Tree(添加css样式到元素上) => 展示 

渲染页面详细流程图：
![渲染页面的详细流程](/image//%E6%B8%B2%E6%9F%93%E9%A1%B5%E9%9D%A2%E7%9A%84%E8%AF%A6%E7%BB%86%E6%B5%81%E7%A8%8B.png)

### 解析一: HTML解析过程
第一步、解析HTML构建DOMTree

### 解析二: 生成CSS规则
第二步、解析HTML是遇到CSS的link元素时，浏览器就会请求对应的CSS资源，下载后就会去解析对应的CSS，在解析对应的CSS的过程中是不会`影响DOM Tree生成过程`，但会影响`Rander Tree的生成`。解析完成后的CSS会生成对应的`CSS规则树`，也可以成为`CSSOM(CSS Object Model, CSS对象模型)`

### 解析三: 构建Render Tree
第三步、将`DOM Tree`和`CSSOM Tree`两者结合来构建成`Render Tree`

注一: link元素不会阻塞`DOM Tree`的构建过程，但会阻塞`Render Tree`的构建过程。

这是因为构建`Render Tree`需要`CSSOM Tree`。

注二: `Render Tree`和`DOM Tree`并不是一一对应的，比如对于display为none的元素，压根不会出现在`Render Tree`中。

### 解析四: 布局(Layout)和绘制(Paint)
第四步、`Render Tree`上运行`布局(Layout)`以计算每个节点的几何体。

+ 渲染树会显示dom节点以及其他样式，但是`不代表每个节点的尺寸、位置`等信息。
+ 布局是确认`呈现树(Render Tree)中所有节点宽度、高度和位置信息`。

第五步、之后将每个节点`绘制(Paint)`到屏幕上
+ 在绘制阶段，浏览器将布局阶段计算的`每个frame转为屏幕上实际的像素点`
+ 包括`将元素的可见部分进行绘制`，比如`文本、颜色、边框、阴影、替换元素(比如img)`

在绘制完后浏览器会进行`合成`

![布局和绘制的过程](/image//布局和绘制的过程.png)

```
拿到内容 => 选择器 => 计算样式 => 构造每个元素的尺寸、位置等 => 布局在确定节点宽度、高度、位置等信息 => 绘制 => 合成
```

# 回流和重绘
### 理解回流(reflow)/重排
+ 在第一次确认节点的大小和位置，称之为布局(layout)。
+ 之后对节点的大小、位置修改重新计算称之为回流。

### 回流的情况: 
+ 比如dom结构发生变化(添加/移除节点)
+ 比如改变了布局(修改了width、height、padding、font-size等值)
+ 比如窗口resize(修改了窗口的尺寸等)
+ 比如调用了getComputedStyle方法获取尺寸、位置信息。

### 理解重绘(repaint)
+ 第一次渲染内容称之为绘制(paint)
+ 之后重新渲染称之为重绘
  
### 重绘情况: 
+ 比如修改背景色、文字颜色、边框颜色、样式等。

### 回流一定会引起重绘，所以回流是意见很消耗性能的事情。

### 所以在开发中尽量避免发生回流:
+ 1.修改样式时尽量一次性修改
  + 比如通过cssText修改，比如通过添加class修改
+ 2.尽量避免频繁的操作DOM
  + 我们可以在一个DocumentFragment或者父元素中将要操作的DOM操作完成，再一次性的操作；
+ 3.尽量避免通过getComputedStyle获取尺寸、位置等信
息；
+ 4.对某些元素使用position的absolute或者fixed
  + 并不是不会引起回流，而是开销相对较小，不会对
其他元素造成影响。